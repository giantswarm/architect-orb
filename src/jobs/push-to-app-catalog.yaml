executor: architect
parameters:
  app_catalog:
    description: "Name of the Github repository inside giantswarm organization hosting the App Catalog for tagged builds."
    type: "string"
  app_catalog_test:
    description: "Name of the Github repository inside giantswarm organization hosting the App Catalog for test builds."
    type: "string"
  chart:
    description: "Name of the chart inside helm directory to push to the App Catalog."
    type: "string"
  chart-testing-config-file:
    description: >-
      Chart Testing config file
      (see: https://github.com/helm/chart-testing#configuration)
    type: string
    default: ""
steps:
  - checkout
  - tools-info
  - prepare-catalogbot-git-ssh
  - helm-chart-template:
      chart: <<parameters.chart>>
  - helm-lint:
      config-file: <<parameters.chart-testing-config-file>>
  - package-and-push:
      app_catalog: <<parameters.app_catalog>>
      app_catalog_test: <<parameters.app_catalog_test>>
      chart: <<parameters.chart>>
