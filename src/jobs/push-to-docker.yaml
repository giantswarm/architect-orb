executor: architect
parameters:
  image:
    description: "Name of the docker image, without tag"
    type: "string"
  password_var:
    default: "ARCHITECT_DOCKER_REGISTRY_PASSWORD"
    description: "Environment variable name holding docker registry password"
    type: "string"
  registry:
    default: "quay.io"
    description: "Docker registry server"
    type: "string"
  username_var:
    default: "ARCHITECT_DOCKER_REGISTRY_USERNAME"
    description: "Environment variable name holding registry username"
    type: "string"
steps:
  - checkout
  - setup_remote_docker:
      docker_layer_caching: true
  - attach_workspace:
      at: .
  - push-to-docker:
      image: <<parameters.image>>
      password_var: <<parameters.password_var>>
      registry: <<parameters.registry>>
      username_var: <<parameters.username_var>>
