parameters:
  cilium-version:
    type: boolean
steps:
  - when:
      steps:
        - run:
            name: "architect/integration-test-install-app-platform: Run apptestctl bootstrap"
            command: |
              export KUBECONFIG=$(kind get kubeconfig)
              helm upgrade --install --version << parameters.cilium-version >> --namespace kube-system --repo https://helm.cilium.io cilium cilium --values - <<EOF
              kubeProxyReplacement: strict
              k8sServiceHost: kind-control-plane
              k8sServicePort: 6443       
              hostServices:
                enabled: false
              externalIPs:
                enabled: true
              nodePort:
                enabled: true
              hostPort:
                enabled: true
              image:
                pullPolicy: IfNotPresent
              ipam:
                mode: kubernetes
              hubble:
                enabled: true
                relay:
                  enabled: true
              localRedirectPolicy: true
              EOF