---
parameters:
  chart:
    type: "string"
description: Test conftest policies
steps:
  - run: |
      if [ -d "helm/<<parameters.chart>>/ci" ]; then
        for t in $(ls helm/<<parameters.chart>>/ci/*.yaml); do helm template --values $t helm/<<parameters.chart>> | conftest test --update $(echo https://raw.githubusercontent.com/swade1987/deprek8ion/master/{1.16-deprek8ion.rego,1.17-deprek8ion.rego,1.18-deprek8ion.rego,1.19-deprek8ion.rego} | tr ' ' ',') - ; done
      else
        helm template helm/<<parameters.chart>> | conftest test --update conftest test --update $(echo https://raw.githubusercontent.com/swade1987/deprek8ion/master/{1.16-deprek8ion.rego,1.17-deprek8ion.rego,1.18-deprek8ion.rego,1.19-deprek8ion.rego} | tr ' ' ',') -
      fi

