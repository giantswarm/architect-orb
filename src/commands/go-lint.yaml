parameters:
  # Many additional parameters are supported by golanglint-ci.
  disable:
    description: "The names of default linting modules to skip."
    type: "string"
  disable-all:
    description: "If set, will disable all linters (except those included by '--enable')."
    type: "boolean"
  enable:
    description: "The names of additional linting modules to run."
    type: "string"
  new-from-rev:
    description: "Show only new issues created after git revision REV."
    type: "string"
  presets:
    description: "Enable preset list of linters (bugs|complexity|format|performance|style|unused)."
    type: "enum"
    enum: ["bugs", "complexity", "format", "performance", "style", "unused", "none"]
  skip-dirs:
    description: "Regular expressions for folder paths which should be skipped."
    type: "string"
  skip-files:
    description: "Regular expressions for file paths which should be skipped."
    type: "string"
  verbose:
    description: "If set, will print verbose output."
    type: "boolean"
steps:
  - run: |
      DISABLE="<< parameters.disable >>"
      DISABLE_ALL="<< parameters.disable-all >>"
      ENABLE="<< parameters.enable >>"
      NEW_FROM_REV="<< parameters.new-from-rev >>"
      PRESETS="<< parameters.presets >>"
      SKIP_DIRS="<< parameters.skip-dirs >>"
      SKIP_FILES="<< parameters.skip-files >>"
      VERBOSE="<< parameters.verbose >>"
      LINT_ARGS="--out-format json"
      if [ -n "${DISABLE}" ]; then
        LINT_ARGS+=" --disable ${DISABLE}";
      fi
      if [ "${DISABLE_ALL}" = "true" ]; then
        LINT_ARGS+=" --disable-all";
      fi
      if [ -n "${ENABLE}" ]; then
        LINT_ARGS+=" --enable ${ENABLE}";
      fi
      if [ -n "${NEW_FROM_REV}" ]; then
        LINT_ARGS+=" --new-from-rev ${NEW_FROM_REV}";
      fi
      if [ "${PRESETS}" != "none" ]; then
        LINT_ARGS+=" --presets ${PRESETS}";
      fi
      if [ -n "${SKIP_DIRS}" ]; then
        LINT_ARGS+=" --skip-dirs ${SKIP_DIRS}";
      fi
      if [ -n "${SKIP_FILES}" ]; then
        LINT_ARGS+=" --skip-files ${SKIP_FILES}";
      fi
      if [ "${VERBOSE}" = "true" ]; then
        LINT_ARGS+=" -v";
      fi
      echo "Running: golangci-lint run $LINT_ARGS"
      golangci-lint run $LINT_ARGS
