steps:
  - go-lint
  - run: |
      echo -n "-w -linkmode 'auto' -extldflags '-static'" > .ldflags
  - run: |
      echo -n " -X '$(go list .)/pkg/project.buildTimestamp=$(date --utc '+%FT%TZ')'" >> .ldflags
  - run: |
      echo -n " -X '$(go list .)/pkg/project.gitSHA=${CIRCLE_SHA1}'" >> .ldflags
  - run: |
      echo "\"$(cat .ldflags)\""
  - run: |
      CGO_ENABLED=0 go list -json -m all | nancy sleuth --skip-update-check --quiet
  - run: |
      CGO_ENABLED=0 go test -ldflags "$(cat .ldflags)" ./...
